@page "/components/password-input"
@rendermode InteractiveServer
@using Blazor.DesignSystem.Components
@using Blazor.DesignSystem.Components.Validation

<PageTitle>Password input - GOV.UK Design System</PageTitle>

<h1 class="govuk-heading-xl">Password input</h1>
<p class="govuk-body">Help users securely enter their password by showing it to them when they need to check what they've entered.</p>

<h2 class="govuk-heading-l">When to use this component</h2>
<p class="govuk-body">Use this component when you ask users for a password. The component allows users to toggle between hiding and showing their password.</p>

<h2 class="govuk-heading-l">Examples</h2>

<h3 class="govuk-heading-m">Default password input</h3>
<GovUkPasswordInput 
    Id="password" 
    Name="password" 
    Label="Enter your password"
    @bind-Value="password1" />
<p class="govuk-body govuk-!-margin-top-2">Value: @(string.IsNullOrWhiteSpace(password1) ? "(empty)" : "********")</p>

<h3 class="govuk-heading-m govuk-!-margin-top-6">Password input with hint</h3>
<GovUkPasswordInput 
    Id="password-with-hint" 
    Name="password-with-hint" 
    Label="Create a password"
    Hint="Your password must be at least 8 characters long and include a number"
    @bind-Value="password2" />

<h3 class="govuk-heading-m govuk-!-margin-top-6">Password input with error</h3>
<GovUkPasswordInput 
    Id="password-with-error" 
    Name="password-with-error" 
    Label="Enter your password"
    HasError="true"
    ErrorMessage="Enter your password"
    @bind-Value="password3" />

<h3 class="govuk-heading-m govuk-!-margin-top-6">Password input for new password</h3>
<GovUkPasswordInput 
    Id="new-password" 
    Name="new-password" 
    Label="Create a new password"
    Hint="Your password must be at least 10 characters and include a capital letter, a number and a symbol"
    Autocomplete="new-password"
    @bind-Value="password4" />

<h2 class="govuk-heading-l govuk-!-margin-top-9">Password validation example</h2>
<p class="govuk-body">This example shows how to validate password requirements in real-time.</p>

@if (showPasswordErrors && !string.IsNullOrEmpty(passwordErrorMessage))
{
    <GovUkErrorSummary 
        Title="There is a problem"
        Errors="@passwordErrorItems" />
}

<form @onsubmit="HandlePasswordSubmit" @onsubmit:preventDefault>
    <GovUkPasswordInput 
        Id="validated-password" 
        Name="validated-password" 
        Label="Create a new password"
        Hint="Your password must be at least 10 characters and include a capital letter, a number and a symbol"
        HasError="@hasPasswordError"
        ErrorMessage="@passwordErrorMessage"
        Autocomplete="new-password"
        @bind-Value="validatedPassword" />

    <GovUkButton Type="submit">Create account</GovUkButton>
</form>

@if (passwordSuccess)
{
    <div class="govuk-panel govuk-panel--confirmation govuk-!-margin-top-6">
        <h2 class="govuk-panel__title">Password accepted</h2>
        <div class="govuk-panel__body">
            Your password meets all requirements
        </div>
    </div>
}

@code {
    private string? password1;
    private string? password2;
    private string? password3;
    private string? password4;
    
    // Validation example
    private string? validatedPassword;
    private bool hasPasswordError = false;
    private string? passwordErrorMessage;
    private bool showPasswordErrors = false;
    private bool passwordSuccess = false;
    private List<GovUkErrorSummary.ErrorItem> passwordErrorItems = new();

    private void HandlePasswordSubmit()
    {
        passwordSuccess = false;
        showPasswordErrors = false;
        hasPasswordError = false;
        passwordErrorMessage = null;
        passwordErrorItems.Clear();

        var result = FormValidationService.ValidatePassword(validatedPassword, new FormValidationService.PasswordValidationOptions
        {
            MinLength = 10,
            RequireUppercase = true,
            RequireDigit = true,
            RequireSymbol = true
        });

        if (!result.IsValid)
        {
            hasPasswordError = true;
            passwordErrorMessage = result.ErrorMessage;
            showPasswordErrors = true;
            passwordErrorItems.Add(new GovUkErrorSummary.ErrorItem
            {
                Message = passwordErrorMessage ?? "Password does not meet requirements",
                FieldId = "validated-password"
            });
        }
        else
        {
            passwordSuccess = true;
        }
    }
}
